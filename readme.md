# Author：黄炎

    基于LLM接口和fastapi开发的一套对话机器人系统，未来或许支持自定义知识库。
    已部署到 https://fastapirag.nxtech.site/ 用户名 admin 密码 admin123456
    自动API文档：https://fastapirag-admin.nxtech.site/docs/
    后端框架fastapi，前端框架vue3,数据库用到sqlite3, (未来)加elasticsearch和redis。

    （待实现）基于langchain使用了nltk进行文本分段，使用了bge3模型进行文本向量化。
    （待实现）核心功能：文档知识库管理，基于知识库进行大模型的答疑，对回答问题提供引用，不回答超出知识库的内容。


## 模块代码介绍
    
    backend 后端
    -- apps 主要业务模块
    ---- user 用户/权限模块
    ---- document 文档模块：保存用户提交的文档，打通elasticsearch以进行向量化与相似检索
    ---- srcfile 源文件模块：源文件存储在阿里云服务器
    ---- message 消息模块：与用户聊天
    ---- chatbot 聊天机器人：用户可以选择与不同的机器人聊天，包括文本机器人、生图机器人、虚拟数字人等。
    ---- engine 机器人引擎：每个机器人都有它的引擎，如kimi,chatgpt等
    ---- mission 任务目标：用户对话或上传文件等操作，可能触发了任务。需要专门运行逻辑解决此任务
    ---- job 工作项：复杂任务目标，会被分解为多个job，分别执行。
    ---- datatrace 埋点：跟踪用户使用情况。
    -- application 运行主模块
    -- celery_task 后台任务核心模块

    web 前端
    -- 登录
    -- 文档
    -- 聊天机器人

## 核心逻辑说明
    document.Article: 保存Article存储到Es，以进行关键字检索。同时触发异步任务，用大模型拆解文章，形成document.Sentence，然后进行向量化存储。
    文本切块策略：基于NLTK对长文章进行切句。分块长度目前暂定400，应依据实践效果优化。
    向量化： 基于sentence-transformers/stsb-xlm-r-multilingual 进行数据向量化
    message.Message: 基于Kimi接收用户消息并处理返回。如果在知识库中检索到消息，则告知依据，否则，简单使用大模型进行回答。
    misssion.Mission: 异步处理复杂用户任务。
    关联信息检索策略：先基于关键字使用es搜索，再基于向量相似度进行第二轮搜索。


## 缺陷与扩展

### 缺陷（因时间有限，以下项目虽可完成，实际未完成）

    1. 初步完成了关键字检索加相似度检索，具体效果需要足量测试实践提升。
    2. 聊天机器人仅实现一种 文本聊天机器人；引擎仅使用一种 kimi聊天机器人；mission开发二种，普通对话及RAG对话。
    3. 代码适宜k8s部署，但仅提供了gunicorn部署。目前已上线，网址为：http://ragproj.nxtech.site/
    4. 微服务化：项目适宜多机部署，可继续拆细接口做微服务化。成本问题暂不考虑。
    5. NLTK段落切分、向量化模型下载到本地，占用空间消耗性能。可以服务化另行部署。
    6. 功能、测试量不足。页面简陋。
    7. 若干前端代码中的实现存在一些问题。

### 扩展（参考模块说明）
    
    ---- message 消息模块：机器人、系统、用户相互聊天。 当前仅支持人对机器人发信息，并收回复。 
    ---- chatbot 聊天机器人：用户可以选择与不同的机器人聊天，包括文本机器人、生图机器人、虚拟数字人等。当前仅启用了一个文本机器人。
    ---- engine 机器人引擎：每个机器人都有它的引擎，如kimi,chatgpt等。当前仅使用了kimi引擎。
    ---- mission 任务目标：用户对话或上传文件等操作，可能触发了任务。需要专门运行逻辑解决此任务。当前仅处理RAG文本任务。
    ---- job 工作项：复杂任务目标，会被分解为多个job，分别执行。
    

    